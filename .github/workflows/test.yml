name: Build

on:
  push:
  pull_request:

jobs:

#  test-ubuntu:
#    runs-on: ubuntu-latest
#
#    steps:
#      - uses: actions/checkout@v2
#
#      # Installing swipl on Debian: https://www.swi-prolog.org/build/PPA.html
#      - name: Install swi-prolog
#        run: |
#          sudo apt-add-repository ppa:swi-prolog/stable
#          sudo apt-get update
#          sudo apt-get install swi-prolog
#
#      - name: Build
#        run: make
#
#  test-macos:
#    runs-on: macos-latest
#
#    steps:
#      - uses: actions/checkout@v2
#
#      # Installing swipl on macOS: https://www.swi-prolog.org/build/macos.html
#      - name: Install swi-prolog
#        run: brew install swi-prolog
#
#      - name: Build
#        run: make

  test-windows:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2

      - name: Install swi-prolog
        run: |
          choco install llvm swi-prolog

          # Update the $PATH to include the new packages. See
          # <https://stackoverflow.com/a/46760714>
          Import-Module "$env:ProgramData\chocolatey\helpers\chocolateyInstaller.psm1"
          Update-SessionEnvironment

          # The following commands update GitHub files to make the environment
          # variables persistent across steps. See
          # <https://docs.github.com/en/actions/reference/workflow-commands-for-github-actions>

          # Append the `swipl` path to the $PATH.
          echo (Split-Path -Path (Get-Command swipl).Source) `
            | Out-File -Encoding utf8 -Append -FilePath $env:GITHUB_PATH

          # Set $LIBCLANG_PATH with the `clang` path.
          echo "LIBCLANG_PATH=$(Split-Path -Path (Get-Command clang).Source)" `
            | Out-File -Encoding utf8 -Append -FilePath $env:GITHUB_ENV

      - name: Build
        shell: bash
        run: |
          # Check that `swipl` works before building.
          swipl --version
          make
